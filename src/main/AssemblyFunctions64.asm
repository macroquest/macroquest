;---------------------------------------------------------------------------------------
; These definitions exist to completely bypass the code generated by the compiler. Be sure
; To also include any of these exported symbols in AssemblyFunctions.def so that they are
; exported in the dll.

; MQ2DetourAPI
extern gbAssistComplete
extern ?SetAssist@mq@@YAXPEAE@Z

; MQ2FrameLimiter
extern ?DoThrottleFrameRate@mq@@YA_NXZ
extern __imp___ThrottleFrameRateEnd
extern ?Throttler_Trampoline@mq@@3P6AXXZEA

section .text

global ?GetAssistParam@mq@@YAXXZ
?GetAssistParam@mq@@YAXXZ:
	push rax
	mov rax, [rsp + 0x38 + 0x20]
	test rax, rax
	jz emptyassist
	push rax
	call ?SetAssist@mq@@YAXPEAE@Z
	pop rax
emptyassist:
	pop rax

;---------------------------------------------------------------------------------------

; If DoThrottleFrameRate returns false, then it is disabled and we
; want to just call the original code. If it returns true then we
; are engaged with the frame limiter and we want to skip past the
; built-in throttling.
global ?Throttler_Detour@mq@@YAXXZ
?Throttler_Detour@mq@@YAXXZ:
	call ?DoThrottleFrameRate@mq@@YA_NXZ
	cmp rax, rax
	jz call_to_trampoline
	mov rax, __imp___ThrottleFrameRateEnd
	jmp rax
call_to_trampoline:
	mov rax, [qword ?Throttler_Trampoline@mq@@3P6AXXZEA]
	jmp rax

